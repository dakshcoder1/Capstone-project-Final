<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Prompt → Image</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
  <link rel="stylesheet" href="styles.css" />
<style>
.preview-box{
  background:#1a1a1a;
  border-radius:10px;
  padding:10px;
  height:350px;
 
  overflow:auto;
  position:relative;
}
.preview-box img{
  max-width:100%;
  max-height:100%;
}
.placeholder{
  color:#aaa;
  text-align:center;
  margin-top:120px;
}
.suggestion-box{
  background:#111;
  border-radius:10px;
  padding:15px;
  height:350px;
  overflow-y:auto;
  color:#eaeaea;
}
.progress-area{
  margin-top:20px;
}
</style>
</head>

<body>
  <div class="app-shell">

    <!-- SIDEBAR -->
    <aside class="sidebar">
      <div class="brand">
        <div class="brand-badge"><i class="bi bi-stars"></i></div>
        <div>
          <h1>Micro Tools Studio</h1>
          <p>Minimal UI • Beginner friendly</p>
        </div>
      </div>

      <div class="nav-title">Tools</div>
      <div class="tool-list">
        <a class="tool-item" href="index.html">
          <div class="tool-icon"><i class="bi bi-grid-1x2"></i></div>
          <div class="tool-meta">
            <p class="tool-name">Dashboard</p>
            <p class="tool-desc">Quick access to all tools</p>
          </div>
        </a>

         <a class="tool-item" href="tool-prompt-enhancer.html">
  <div class="tool-icon">
    <i class="bi bi-cpu"></i>
  </div>
  <div class="tool-meta">
    <p class="tool-name">Prompt Enhancer</p>
    <p class="tool-desc">Enhance your prompts</p>
  </div>
</a>



        <a class="tool-item active" href="tool-prompt-to-image.html">
          <div class="tool-icon"><i class="bi bi-magic"></i></div>
          <div class="tool-meta">
            <p class="tool-name">Prompt → Image</p>
            <p class="tool-desc">Text prompt to image</p>
          </div>
        </a>
        
      

        <a class="tool-item" href="tool-image-to-style.html">
          <div class="tool-icon"><i class="bi bi-palette2"></i></div>
          <div class="tool-meta">
            <p class="tool-name">Image → Style</p>
            <p class="tool-desc">Apply a style to an image</p>
          </div>
        </a>

        <a class="tool-item" href="tool-specs-tryon.html">
          <div class="tool-icon"><i class="bi bi-eyeglasses"></i></div>
          <div class="tool-meta">
            <p class="tool-name">Specs Try-On</p>
            <p class="tool-desc">Face + Specs overlay</p>
          </div>
        </a>

        <a class="tool-item" href="tool-haircut-preview.html">
          <div class="tool-icon"><i class="bi bi-scissors"></i></div>
          <div class="tool-meta">
            <p class="tool-name">Haircut Preview</p>
            <p class="tool-desc">Face + Hair style sample</p>
          </div>
        </a>
        <a class="tool-item" href="tool-insta-post-generator.html">
          <div class="tool-icon"><i class="bi bi-plus-square"></i></i></div>
          <div class="tool-meta">
            <p class="tool-name">Insta Post Generator</p>
            <p class="tool-desc">Ready Insta Post</p>
          </div>
        </a>
        <a class="tool-item" href="tool-insta-Story-Template.html">
          <div class="tool-icon"><i class="bi bi-phone"></i></i></div>
          <div class="tool-meta">
            <p class="tool-name">Insta Story Template</p>
            <p class="tool-desc">Get Insta Story</p>
          </div>
        </a>
        <a class="tool-item" href="tool-healthy-poster-analayser.html">
          <div class="tool-icon"><i class="bi bi-person-check"></i></i></div>
          <div class="tool-meta">
            <p class="tool-name">Healthy-Poster-Analayser</p>
            <p class="tool-desc">Get Insta Story</p>
          </div>
        </a>
        <a class="tool-item" href="tool-safety-gear.html">
          <div class="tool-icon"><i class="bi bi-shield-check"></i></i></div>
          <div class="tool-meta">
            <p class="tool-name">Safety Gear Try-On</p>
            <p class="tool-desc">Get Safety Gear Try</p>
          </div>
        </a>
        <a class="tool-item" href="tool-story-image-generater.html">
          <div class="tool-icon"><i class="bi bi-journal-richtext"></i></i></div>
          <div class="tool-meta">
            <p class="tool-name">Story-Image Generater</p>
            <p class="tool-desc">get the story in Image</p>
          </div>
        </a>


        <a class="tool-item" href="history.html">
          <div class="tool-icon"><i class="bi bi-clock-history"></i></div>
          <div class="tool-meta">
            <p class="tool-name">History</p>
            <p class="tool-desc">All previous requests</p>
          </div>
        </a>
      </div>
    </aside>

 
 <main class="main">

<!-- TOP BAR -->
<div class="topbar">
  <div>
    <p class="page-title">Healthy Posture Analyzer</p>
    <p class="page-subtitle">Upload posture image → get corrected posture & AI suggestions</p>
  </div>
  <div class="d-flex gap-2">
    <button class="btn btn-elegant" id="clearBtn">
      <i class="bi bi-trash3"></i> Clear
    </button>
    <button class="btn btn-primary" id="analyzeBtn">
      <i class="bi bi-play-fill"></i> Analyze Posture
    </button>
  </div>
</div>

<div class="panel mt-3">
<div class="panel-body">

<!-- IMAGE UPLOAD -->
<input type="file" class="form-control mb-4" id="imageInput" accept="image/*">

<!-- IMAGE PREVIEW ROW -->
<div class="row g-4">

  <!-- ORIGINAL IMAGE BOX -->
  <div class="col-md-6">
    <div class="preview-thumb resizable">
      <img id="originalImg" style="display:none">

      <div id="originalPlaceholder" class="text-center px-3">
        <i class="bi bi-image" style="font-size:28px;"></i>
        <div class="mt-2" style="font-size:12px;color:rgba(83,247,228,.6)">
          Upload posture image
        </div>
      </div>
    </div>
  </div>

  <!-- CORRECTED IMAGE BOX -->
  <div class="col-md-6">
    <div class="preview-thumb resizable">
      <img id="correctedImg" style="display:none">

      <div id="correctedPlaceholder" class="text-center px-3">
        <i class="bi bi-person-check" style="font-size:28px;"></i>
        <div class="mt-2" style="font-size:12px;color:rgba(83,247,228,.6)">
          AI corrected posture
        </div>
      </div>
    </div>
  </div>

</div>

<!-- SUGGESTIONS + SCORES -->
<div class="row g-4 mt-4">

<!-- GEMINI SUGGESTIONS -->
<div class="col-md-6">
<h6>AI Suggestions (Gemini)</h6>
<div class="suggestion-box p-3" id="suggestions">
  <p class="text-muted">Posture improvement tips will appear here...</p>
</div>
</div>

<!-- POSTURE SCORES -->
<div class="col-md-6">
<h6>Posture Scores</h6>

<label>Spine Alignment</label>
<div class="progress mb-3">
  <div class="progress-bar bg-success" id="spineBar" style="width:0%">0%</div>
</div>

<label>Neck Angle</label>
<div class="progress mb-3">
  <div class="progress-bar bg-warning" id="neckBar" style="width:0%">0%</div>
</div>

<label>Shoulder Balance</label>
<div class="progress">
  <div class="progress-bar bg-info" id="shoulderBar" style="width:0%">0%</div>
</div>
</div>

</div>

</div>
</div>

</main>

<script>
const imageInput = document.getElementById("imageInput");
const originalImg = document.getElementById("originalImg");
const correctedImg = document.getElementById("correctedImg");
const analyzeBtn = document.getElementById("analyzeBtn");
const clearBtn = document.getElementById("clearBtn");

/* ----------------------------------
   1️⃣ ORIGINAL POSTURE PREVIEW
---------------------------------- */
imageInput.addEventListener("change", () => {
  const file = imageInput.files[0];
  if (!file) return;

  originalImg.src = URL.createObjectURL(file);
  originalImg.style.display = "block";
  document.getElementById("originalPlaceholder").style.display = "none";
});

/* ----------------------------------
   2️⃣ ANALYZE POSTURE (BACKEND)
---------------------------------- */
analyzeBtn.addEventListener("click", async () => {
  const file = imageInput.files[0];
  if (!file) return alert("Please upload an image");

  analyzeBtn.disabled = true;
  analyzeBtn.innerHTML = "Analyzing...";

  const formData = new FormData();
  formData.append("image", file);

  try {
    const token = localStorage.getItem("token");
    const res = await fetch("http://127.0.0.1:5000/api/posture-analyze", {
      method: "POST",
       headers: { 
             "Authorization": "Bearer " + token
          },
      body: formData
    });

    const data = await res.json();

    if (!res.ok || !data.success) {
      alert(data.error || "Analysis failed");
      return;
    }

    // corrected posture image from backend
    correctedImg.src = data.corrected_image_url + "?v=" + Date.now();
    correctedImg.style.display = "block";
    document.getElementById("correctedPlaceholder").style.display = "none";

    // Gemini suggestions
    document.getElementById("suggestions").innerHTML =
      "<pre>" + data.suggestions + "</pre>";

    // progress bars
    setBar("spineBar", data.scores.spine);
    setBar("neckBar", data.scores.neck);
    setBar("shoulderBar", data.scores.shoulder);

  } catch (err) {
    console.error(err);
    alert("Backend not reachable");
  } finally {
    analyzeBtn.disabled = false;
    analyzeBtn.innerHTML = "Analyze Posture";
  }
});

/* ----------------------------------
   3️⃣ CLEAR BUTTON (FULL RESET)
---------------------------------- */
clearBtn.addEventListener("click", () => {
  // reset file input
  imageInput.value = "";

  // original image
  originalImg.src = "";
  originalImg.style.display = "none";
  document.getElementById("originalPlaceholder").style.display = "block";

  // corrected image
  correctedImg.src = "";
  correctedImg.style.display = "none";
  document.getElementById("correctedPlaceholder").style.display = "block";

  // suggestions
  document.getElementById("suggestions").innerHTML =
    "<p class='text-muted'>Posture improvement tips will appear here...</p>";

  // progress bars reset
  setBar("spineBar", 0);
  setBar("neckBar", 0);
  setBar("shoulderBar", 0);

  // button reset
  analyzeBtn.disabled = false;
  analyzeBtn.innerHTML = "Analyze Posture";
});

/* ----------------------------------
   PROGRESS BAR HELPER
---------------------------------- */
function setBar(id, value) {
  const bar = document.getElementById(id);
  bar.style.width = value + "%";
  bar.innerText = value + "%";
}
</script>

